cmake_minimum_required(VERSION 3.4)

include(ExternalProject)

set(CMAKE_STAGING_PREFIX ${CMAKE_CURRENT_BINARY_DIR}/staging CACHE PATH "")

execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_STAGING_PREFIX})

ExternalProject_Add(foo
	SOURCE_DIR ${CMAKE_CURRENT_LIST_DIR}/foo
	BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR}/foo-build
	BUILD_ALWAYS 1
	CMAKE_ARGS
		-DCMAKE_GENERATOR=${CMAKE_GENERATOR}
		-DCMAKE_STAGING_PREFIX=${CMAKE_STAGING_PREFIX}
	INSTALL_DIR ${CMAKE_STAGING_PREFIX}
	)

ExternalProject_Add(bar
	DEPENDS foo
	SOURCE_DIR ${CMAKE_CURRENT_LIST_DIR}/bar
	BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR}/bar-build
	BUILD_ALWAYS 1
	CMAKE_ARGS
		-DCMAKE_GENERATOR=${CMAKE_GENERATOR}
		-DCMAKE_STAGING_PREFIX=${CMAKE_STAGING_PREFIX}
	INSTALL_DIR ${CMAKE_STAGING_PREFIX}
	INSTALL_COMMAND ""
	)

